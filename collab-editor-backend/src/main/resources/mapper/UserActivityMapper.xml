<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.collab.collab_editor_backend.mapper.UserActivityMapper">

    <select id="getUserActivities" resultType="com.collab.collab_editor_backend.entity.UserActivity">
        SELECT * FROM t_user_activity
        <where>
            <if test="userId != null">
                AND user_id = #{userId}
            </if>
            <if test="activityType != null and activityType != ''">
                AND activity_type = #{activityType}
            </if>
            <if test="startTime != null">
                AND created_at &gt;= #{startTime}
            </if>
            <if test="endTime != null">
                AND created_at &lt;= #{endTime}
            </if>
        </where>
        ORDER BY created_at DESC
    </select>

    <select id="countActivityTypeDistribution" resultType="java.util.Map">
        SELECT activity_type as activityType, COUNT(*) as count
        FROM t_user_activity
        <where>
            <if test="userId != null">
                AND user_id = #{userId}
            </if>
            <if test="startTime != null">
                AND created_at &gt;= #{startTime}
            </if>
            <if test="endTime != null">
                AND created_at &lt;= #{endTime}
            </if>
        </where>
        GROUP BY activity_type
    </select>

    <select id="countActiveDays" resultType="java.lang.Integer">
        SELECT COUNT(DISTINCT DATE(created_at))
        FROM t_user_activity
        <where>
            <if test="userId != null">
                AND user_id = #{userId}
            </if>
            <if test="startTime != null">
                AND created_at &gt;= #{startTime}
            </if>
            <if test="endTime != null">
                AND created_at &lt;= #{endTime}
            </if>
        </where>
    </select>

    <select id="getRecentActivities" resultType="com.collab.collab_editor_backend.entity.UserActivity">
        SELECT * FROM t_user_activity
        <where>
            <if test="userId != null">
                AND user_id = #{userId}
            </if>
        </where>
        ORDER BY created_at DESC
        LIMIT #{limit}
    </select>

</mapper>
